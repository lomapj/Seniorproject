---
import Layout from '../layouts/Layout.astro';

const listings = [
  { id: 1,  title: 'Biology Textbook',     price: 45,  category: 'Books',       gradient: 'linear-gradient(135deg,#2d6a4f,#52b788)', icon: 'ðŸ“—', status: 'available' },
  { id: 2,  title: 'MacBook Pro 2019',     price: 800, category: 'Electronics', gradient: 'linear-gradient(135deg,#1d3557,#457b9d)', icon: 'ðŸ’»', status: 'available' },
  { id: 3,  title: 'Desk Lamp',            price: 15,  category: 'Furniture',   gradient: 'linear-gradient(135deg,#e9c46a,#f4a261)', icon: 'ðŸ”†', status: 'available' },
  { id: 4,  title: 'School Backpack',      price: 30,  category: 'Misc',        gradient: 'linear-gradient(135deg,#ef476f,#f78c6b)', icon: 'ðŸŽ’', status: 'sold'      },
];
---

<Layout title="My Profile">
  <div class="profile-page">

    <!-- Cover + Avatar -->
    <div class="cover-area">
      <div class="cover-photo">
        <div class="cover-overlay"></div>
      </div>
      <div class="container profile-header-content">
        <div class="avatar-wrap">
          <div class="profile-avatar">SJ</div>
        </div>
        <div class="profile-info">
          <div class="name-row">
            <h1 class="profile-name">Sarah Johnson</h1>
            <a href="#" class="btn-edit-profile">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Edit Profile
            </a>
          </div>
          <div class="profile-rating">
            <span class="stars" style="font-size:0.9rem">â˜…â˜…â˜…â˜…Â½</span>
            <span class="stars-text">4.5 (12 reviews)</span>
          </div>
          <p class="profile-bio">Junior at Farmingdale State College. Selling textbooks and dorm essentials. Quick to respond and meet on campus!</p>
          <div class="profile-stats">
            <div class="stat">
              <span class="stat-num">4</span>
              <span class="stat-label">Listings</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat">
              <span class="stat-num">18</span>
              <span class="stat-label">Sales</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat">
              <span class="stat-num">12</span>
              <span class="stat-label">Reviews</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <div class="container profile-body">

      <!-- Tabs -->
      <div class="tabs" id="tabs">
        <button type="button" class="tab active" data-tab="listings">My Listings</button>
        <button type="button" class="tab" data-tab="reviews">Reviews</button>
        <button type="button" class="tab" data-tab="history">Transaction History</button>
      </div>

      <!-- Listings Tab -->
      <div class="tab-content" id="tab-listings">
        <div class="listings-toolbar">
          <div class="search-wrap">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" class="search-icon">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" class="listings-search" placeholder="Search listings..." />
          </div>
          <div class="toolbar-right">
            <select class="form-select toolbar-select">
              <option>Filter by Status</option>
              <option>Available</option>
              <option>Pending</option>
              <option>Sold</option>
            </select>
            <select class="form-select toolbar-select">
              <option>Sort by</option>
              <option>Newest</option>
              <option>Price: Low</option>
              <option>Price: High</option>
            </select>
            <a href="/post" class="btn-new-listing">+ New Listing</a>
          </div>
        </div>

        <div class="my-listings-grid">
          {listings.map(item => (
            <div class="my-listing-card">
              <div class="my-card-img" style={`background:${item.gradient}`}>
                <span style="font-size:2.8rem;user-select:none">{item.icon}</span>
                {item.status === 'sold' && (
                  <div class="sold-overlay">
                    <span class="sold-label">SOLD</span>
                  </div>
                )}
              </div>
              <div class="my-card-body">
                <span class="tag" style="font-size:0.65rem">{item.category}</span>
                <p class="my-card-title">{item.title}</p>
                <p class="my-card-price">${item.price}</p>
              </div>
              <div class="my-card-actions">
                <button type="button" class="my-action-btn edit">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                  Edit
                </button>
                <button type="button" class="my-action-btn delete">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
                  </svg>
                  Delete
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Reviews Tab (hidden) -->
      <div class="tab-content" id="tab-reviews" style="display:none">
        <div class="reviews-list">
          {[
            { reviewer: 'Michael T.', initials: 'MT', color: '#1d3557', rating: 5, text: 'Great seller! Item was exactly as described and she was very responsive. Would definitely buy from again.', date: 'Jan 12, 2025', item: 'Chemistry Lab Manual' },
            { reviewer: 'Jake P.',    initials: 'JP', color: '#606c38', rating: 4, text: 'Fast response and smooth transaction. Met at the library as agreed. Textbook was in good condition.', date: 'Dec 5, 2024',  item: 'Biology Textbook' },
            { reviewer: 'Lily C.',    initials: 'LC', color: '#c77dff', rating: 5, text: 'Super easy to work with. The desk lamp works perfectly. Will buy again if she lists more stuff!', date: 'Nov 18, 2024', item: 'Desk Lamp' },
          ].map(review => (
            <div class="review-card">
              <div class="review-header">
                <div class="review-user">
                  <div class="review-avatar" style={`background:${review.color}`}>{review.initials}</div>
                  <div>
                    <p class="review-name">{review.reviewer}</p>
                    <p class="review-item-ref">re: {review.item}</p>
                  </div>
                </div>
                <div class="review-right">
                  <div class="review-stars">
                    {'â˜…'.repeat(review.rating).split('').map(() => <span class="stars" style="font-size:0.9rem">â˜…</span>)}
                  </div>
                  <p class="review-date">{review.date}</p>
                </div>
              </div>
              <p class="review-text">{review.text}</p>
            </div>
          ))}
        </div>
      </div>

      <!-- History Tab (hidden) -->
      <div class="tab-content" id="tab-history" style="display:none">
        <div class="history-table-wrap">
          <table class="history-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Role</th>
                <th>Price</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {[
                { item: 'Biology Textbook',    role: 'Seller', price: '$45',  date: 'Jan 12, 2025', status: 'Completed' },
                { item: 'MacBook Pro 2020',    role: 'Buyer',  price: '$800', date: 'Dec 20, 2024', status: 'Completed' },
                { item: 'Chemistry Lab Manual',role: 'Seller', price: '$18',  date: 'Dec 5, 2024',  status: 'Completed' },
                { item: 'Desk Lamp',           role: 'Seller', price: '$15',  date: 'Nov 18, 2024', status: 'Completed' },
                { item: 'Wireless Headphones', role: 'Buyer',  price: '$60',  date: 'Oct 30, 2024', status: 'Completed' },
              ].map(row => (
                <tr>
                  <td class="h-item">{row.item}</td>
                  <td><span class={`role-badge ${row.role.toLowerCase()}`}>{row.role}</span></td>
                  <td class="h-price">{row.price}</td>
                  <td class="h-date">{row.date}</td>
                  <td><span class="status-chip available">{row.status}</span></td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</Layout>

<style>
  .profile-page { padding-bottom: 3rem; }

  /* Cover */
  .cover-area { position: relative; }

  .cover-photo {
    height: 200px;
    background: linear-gradient(135deg, #006153 0%, #004d42 40%, #1d3557 100%);
    position: relative;
    overflow: hidden;
  }

  .cover-photo::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Ccircle cx='30' cy='30' r='12'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }

  .cover-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.15));
  }

  .profile-header-content {
    padding-top: 0;
    padding-bottom: 1.5rem;
    display: flex;
    gap: 1.5rem;
    align-items: flex-end;
    position: relative;
    margin-top: -60px;
  }

  @media (max-width: 600px) {
    .profile-header-content { flex-direction: column; align-items: center; text-align: center; }
  }

  .avatar-wrap { flex-shrink: 0; }

  .profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: var(--green);
    color: white;
    font-size: 2rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 4px solid white;
    box-shadow: var(--shadow-md);
  }

  .profile-info {
    flex: 1;
    padding-bottom: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .name-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .profile-name { font-size: 1.5rem; font-weight: 800; color: var(--gray-800); }

  .btn-edit-profile {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    background: white;
    border: 1.5px solid var(--gray-200);
    color: var(--gray-700);
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.4rem 0.9rem;
    border-radius: var(--radius-sm);
    text-decoration: none;
    cursor: pointer;
    font-family: var(--font);
    transition: border-color 0.15s, color 0.15s;
  }

  .btn-edit-profile:hover { border-color: var(--green); color: var(--green); }

  .profile-bio { font-size: 0.85rem; color: var(--gray-600); max-width: 520px; }

  .profile-stats {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    margin-top: 0.25rem;
  }

  .stat { display: flex; flex-direction: column; align-items: center; gap: 0.1rem; }
  .stat-num   { font-size: 1.1rem; font-weight: 800; color: var(--gray-800); }
  .stat-label { font-size: 0.72rem; color: var(--gray-500); font-weight: 500; }
  .stat-divider { width: 1px; height: 28px; background: var(--gray-200); }

  /* Tabs */
  .profile-body { padding-top: 1.5rem; }

  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--gray-200);
    margin-bottom: 1.5rem;
  }

  .tab {
    background: none;
    border: none;
    padding: 0.75rem 1.25rem;
    font-size: 0.88rem;
    font-weight: 600;
    color: var(--gray-500);
    cursor: pointer;
    font-family: var(--font);
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: color 0.15s;
  }

  .tab.active { color: var(--green); border-bottom-color: var(--green); }
  .tab:hover  { color: var(--green); }

  /* Listings toolbar */
  .listings-toolbar {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
    flex-wrap: wrap;
  }

  .search-wrap { position: relative; flex: 1; min-width: 180px; }

  .search-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    pointer-events: none;
  }

  .listings-search {
    width: 100%;
    padding: 0.5rem 0.75rem 0.5rem 2.1rem;
    border: 1.5px solid var(--gray-200);
    border-radius: var(--radius-sm);
    font-size: 0.82rem;
    font-family: var(--font);
    outline: none;
    transition: border-color 0.15s;
  }

  .listings-search:focus { border-color: var(--green); }

  .toolbar-right { display: flex; align-items: center; gap: 0.6rem; flex-wrap: wrap; margin-left: auto; }

  .toolbar-select { width: 150px; font-size: 0.82rem; padding: 0.5rem 2rem 0.5rem 0.75rem; }

  .btn-new-listing {
    background: var(--green);
    color: white;
    font-weight: 700;
    font-size: 0.82rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    text-decoration: none;
    white-space: nowrap;
    transition: background 0.15s;
  }

  .btn-new-listing:hover { background: var(--green-hover); }

  /* My listing cards */
  .my-listings-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.25rem;
  }

  @media (max-width: 900px)  { .my-listings-grid { grid-template-columns: repeat(3, 1fr); } }
  @media (max-width: 600px)  { .my-listings-grid { grid-template-columns: repeat(2, 1fr); } }

  .my-listing-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-md);
    overflow: hidden;
    transition: box-shadow 0.18s;
  }

  .my-listing-card:hover { box-shadow: var(--shadow-md); }

  .my-card-img {
    height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  .sold-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sold-label {
    background: var(--red);
    color: white;
    font-size: 0.78rem;
    font-weight: 800;
    padding: 0.35rem 0.85rem;
    border-radius: 4px;
    letter-spacing: 0.08em;
  }

  .my-card-body {
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    border-bottom: 1px solid var(--gray-100);
  }

  .my-card-title { font-size: 0.85rem; font-weight: 700; color: var(--gray-800); }
  .my-card-price { font-size: 0.95rem; font-weight: 800; color: var(--green); }

  .my-card-actions {
    display: flex;
    padding: 0.5rem 0.75rem;
    gap: 0.5rem;
  }

  .my-action-btn {
    flex: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.3rem;
    padding: 0.4rem 0;
    border-radius: var(--radius-sm);
    border: 1.5px solid;
    font-size: 0.75rem;
    font-weight: 600;
    font-family: var(--font);
    cursor: pointer;
    transition: background 0.15s;
  }

  .my-action-btn.edit {
    color: var(--green);
    border-color: var(--green);
    background: transparent;
  }

  .my-action-btn.edit:hover { background: var(--green-light); }

  .my-action-btn.delete {
    color: var(--red);
    border-color: var(--red);
    background: transparent;
  }

  .my-action-btn.delete:hover { background: var(--red-light); }

  /* Reviews */
  .reviews-list { display: flex; flex-direction: column; gap: 1rem; }

  .review-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-md);
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .review-user { display: flex; align-items: center; gap: 0.75rem; }

  .review-avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .review-name     { font-size: 0.88rem; font-weight: 700; }
  .review-item-ref { font-size: 0.75rem; color: var(--gray-400); }

  .review-right { text-align: right; }
  .review-stars { display: flex; justify-content: flex-end; }
  .review-date  { font-size: 0.72rem; color: var(--gray-400); margin-top: 0.2rem; }

  .review-text { font-size: 0.85rem; color: var(--gray-600); line-height: 1.6; }

  /* History table */
  .history-table-wrap { overflow-x: auto; }

  .history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  .history-table th {
    text-align: left;
    padding: 0.75rem 1rem;
    background: var(--gray-50);
    border-bottom: 2px solid var(--gray-200);
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .history-table td {
    padding: 0.85rem 1rem;
    border-bottom: 1px solid var(--gray-100);
    vertical-align: middle;
  }

  .history-table tr:hover td { background: var(--gray-50); }

  .h-item  { font-weight: 600; color: var(--gray-800); }
  .h-price { font-weight: 700; color: var(--green); }
  .h-date  { color: var(--gray-500); }

  .role-badge {
    font-size: 0.7rem;
    font-weight: 700;
    padding: 0.2rem 0.55rem;
    border-radius: 20px;
    text-transform: capitalize;
  }

  .role-badge.seller { background: var(--green-light); color: var(--green); }
  .role-badge.buyer  { background: #dbeafe; color: #1d4ed8; }
</style>

<script>
  const tabs   = document.querySelectorAll<HTMLButtonElement>('.tab');
  const panels = document.querySelectorAll<HTMLElement>('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      const target = tab.dataset.tab;
      panels.forEach(panel => {
        panel.style.display = panel.id === `tab-${target}` ? 'block' : 'none';
      });
    });
  });
</script>
