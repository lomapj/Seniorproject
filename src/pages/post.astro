---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Post an Item">
  <div class="post-page">
    <div class="container mini-container">
      <div class="post-header">
        <h1 class="post-title">Create New Listing</h1>
        <p class="post-subtitle">
          Share your item with the Farmingdale community. Fill out the details
          below to get started.
        </p>
      </div>

      <div class="post-content-grid">
        <!-- Form Side -->
        <div class="post-form-area">
          <form class="premium-form" id="listingForm">
            <!-- Section: Photos -->
            <div class="form-card">
              <div class="form-card-header">
                <h2 class="form-card-title">Item Photos</h2>
                <span class="form-card-hint">Up to 5 high-quality photos</span>
              </div>

              <div class="upload-zone" id="uploadZone">
                <input
                  type="file"
                  id="fileInput"
                  multiple
                  accept="image/*"
                  hidden
                />
                <div class="upload-content">
                  <div class="upload-icon-circle">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      ><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                      ></path><polyline points="17 8 12 3 7 8"></polyline><line
                        x1="12"
                        y1="3"
                        x2="12"
                        y2="15"></line></svg
                    >
                  </div>
                  <p class="upload-text">
                    <strong>Click to upload</strong> or drag and drop
                  </p>
                  <p class="upload-subtext">
                    PNG, JPG or WEBP (max. 10MB each)
                  </p>
                </div>
              </div>
              <div class="upload-previews" id="uploadPreviews"></div>
            </div>

            <!-- Section: Details -->
            <div class="form-card">
              <div class="form-card-header">
                <h2 class="form-card-title">Listing Details</h2>
              </div>

              <div class="form-grid">
                <div class="form-group full">
                  <label for="title"
                    >Title <span class="required">*</span></label
                  >
                  <input
                    type="text"
                    id="title"
                    placeholder="e.g. Biology Textbook 12th Edition"
                    maxlength="80"
                    required
                  />
                  <div class="input-info">
                    <span>Be descriptive and include key details</span>
                    <span id="titleCount">0/80</span>
                  </div>
                </div>

                <div class="form-group">
                  <label for="category"
                    >Category <span class="required">*</span></label
                  >
                  <select id="category" required>
                    <option value="" disabled selected>Select category</option>
                    <option>Books</option>
                    <option>Electronics</option>
                    <option>Furniture</option>
                    <option>Clothing</option>
                    <option>Misc</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="condition"
                    >Condition <span class="required">*</span></label
                  >
                  <select id="condition" required>
                    <option value="" disabled selected>Select condition</option>
                    <option>New</option>
                    <option>Like New</option>
                    <option>Good</option>
                    <option>Fair</option>
                    <option>Poor</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="price"
                    >Price <span class="required">*</span></label
                  >
                  <div class="price-input-wrapper">
                    <span class="currency-sign">$</span>
                    <input
                      type="number"
                      id="price"
                      placeholder="0.00"
                      step="0.01"
                      min="0"
                      required
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="status">Initial Status</label>
                  <select id="status">
                    <option value="available">Available</option>
                    <option value="pending">Pending</option>
                  </select>
                </div>

                <div class="form-group full">
                  <label for="description"
                    >Description <span class="required">*</span></label
                  >
                  <textarea
                    id="description"
                    rows="5"
                    placeholder="Tell buyers more about your item. Include details like brand, model, usage, or any flaws."
                    maxlength="1000"
                    required></textarea>
                  <div class="input-info">
                    <span>Provide as much detail as possible</span>
                    <span id="descCount">0/1000</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                type="button"
                class="btn-ghost-lg"
                onclick="window.history.back()">Cancel</button
              >
              <button type="submit" class="btn-primary-lg"
                >Publish Listing</button
              >
            </div>
          </form>
        </div>

        <!-- Sidebar Side -->
        <aside class="post-sidebar">
          <div class="sidebar-sticky">
            <!-- Preview Card -->
            <div class="preview-container">
              <div class="preview-header">
                <p class="preview-label">Live Preview</p>
                <div class="preview-status-indicator">
                  <span class="status-dot"></span>
                  Updating...
                </div>
              </div>

              <div class="listing-preview-card">
                <div class="preview-img-placeholder" id="previewImg">
                  <div class="placeholder-content">
                    <svg
                      width="40"
                      height="40"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      ><rect x="3" y="3" width="18" height="18" rx="2"
                      ></rect><circle cx="8.5" cy="8.5" r="1.5"
                      ></circle><polyline points="21 15 16 10 5 21"
                      ></polyline></svg
                    >
                    <p>Image preview</p>
                  </div>
                </div>
                <div class="preview-content">
                  <div class="preview-top">
                    <span class="preview-cat-tag" id="previewCat">Category</span
                    >
                    <span class="preview-price-tag" id="previewPrice">$0</span>
                  </div>
                  <h3 class="preview-item-title" id="previewTitle">
                    Your listing title here
                  </h3>
                  <div class="preview-bottom">
                    <div class="preview-condition-wrap">
                      <span class="condition-dot"></span>
                      <span id="previewCondition">Condition</span>
                    </div>
                    <span class="preview-location">Campus Center</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tips Card -->
            <div class="tips-card">
              <div class="tips-header">
                <div class="tips-icon">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="M12 2v4"></path><path d="m4.93 4.93 2.83 2.83"
                    ></path><path d="M2 12h4"></path><path
                      d="m4.93 19.07 2.83-2.83"></path><path d="M12 22v-4"
                    ></path><path d="m19.07 19.07-2.83-2.83"></path><path
                      d="M22 12h-4"></path><path d="m19.07 4.93-2.83 2.83"
                    ></path><path d="M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"
                    ></path></svg
                  >
                </div>
                <h3 class="tips-title">Quick Selling Tips</h3>
              </div>
              <ul class="tips-list">
                <li>
                  <span class="tip-num">1</span>
                  <p>
                    <strong>Use good lighting.</strong> Bright, clear photos sell
                    items 3x faster.
                  </p>
                </li>
                <li>
                  <span class="tip-num">2</span>
                  <p>
                    <strong>Set a fair price.</strong> Check similar listings to see
                    going rates.
                  </p>
                </li>
                <li>
                  <span class="tip-num">3</span>
                  <p>
                    <strong>Be responsive.</strong> Buyers appreciate quick answers
                    to questions.
                  </p>
                </li>
              </ul>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
</Layout>

<style>
  .post-page {
    background: var(--gray-50);
    min-height: 100vh;
    padding-top: 3rem;
    padding-bottom: 5rem;
  }
  .mini-container {
    max-width: 1000px !important;
  }

  .post-header {
    margin-bottom: 2.5rem;
  }
  .post-title {
    font-size: 2.25rem;
    font-weight: 800;
    color: var(--gray-900);
    letter-spacing: -0.02em;
  }
  .post-subtitle {
    font-size: 1.1rem;
    color: var(--gray-500);
    margin-top: 0.5rem;
  }

  .post-content-grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 2.5rem;
    align-items: start;
  }

  @media (max-width: 968px) {
    }
  }

  .premium-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .form-card {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-sm);
  }

  .form-card-header {
    margin-bottom: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
  }
  .form-card-title {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--gray-900);
  }
  .form-card-hint {
    font-size: 0.85rem;
    color: var(--gray-400);
    font-weight: 500;
  }

  /* Upload Zone */
  .upload-zone {
    border: 2px dashed var(--gray-200);
    border-radius: var(--radius-md);
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--gray-50);
  }
  .upload-zone:hover {
    border-color: var(--primary);
    background: var(--primary-soft);
  }
  .upload-zone.dragover {
    border-color: var(--primary);
    background: var(--primary-soft);
  }

  .upload-icon-circle {
    width: 60px;
    height: 60px;
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    box-shadow: var(--shadow-sm);
  }
  .upload-text {
    font-size: 1rem;
    color: var(--gray-600);
    margin-bottom: 0.25rem;
  }
  .upload-text strong {
    color: var(--primary);
    font-weight: 700;
  }
  .upload-subtext {
    font-size: 0.85rem;
    color: var(--gray-400);
  }

  .upload-previews {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  /* Form Grid */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }
  .form-group.full {
    grid-column: span 2;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .form-group label {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--gray-700);
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }
  .required {
    color: #ef4444;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 0.85rem 1rem;
    border: 1.5px solid var(--gray-200);
    border-radius: var(--radius-md);
    font-size: 1rem;
    font-family: inherit;
    outline: none;
    transition: all 0.2s;
    background: var(--gray-50);
  }
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    background: var(--white);
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-soft);
  }

  .price-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  .currency-sign {
    position: absolute;
    left: 1rem;
    font-weight: 700;
    color: var(--gray-400);
  }
  .price-input-wrapper input {
    padding-left: 2rem;
    width: 100%;
  }

  .input-info {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--gray-400);
    font-weight: 500;
    margin-top: 0.25rem;
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1.5rem;
    margin-top: 1rem;
  }
  .btn-ghost-lg {
    padding: 1rem 2rem;
    font-size: 1rem;
    font-weight: 700;
    border: none;
    background: none;
    color: var(--gray-400);
    cursor: pointer;
    transition: color 0.2s;
  }
  .btn-ghost-lg:hover {
    color: var(--gray-700);
  }
  .btn-primary-lg {
    padding: 1rem 2.5rem;
    font-size: 1rem;
    font-weight: 800;
    border: none;
    border-radius: var(--radius-md);
    background: var(--primary);
    color: var(--white);
    cursor: pointer;
    box-shadow: var(--shadow-md);
    transition: all 0.2s;
  }
  .btn-primary-lg:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* Sidebar */
  .post-sidebar {
    position: sticky;
    top: 100px;
  }
  .sidebar-sticky {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* Preview Card */
  .preview-container {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
  }
  .preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .preview-label {
    font-size: 0.75rem;
    font-weight: 800;
    color: var(--gray-400);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .preview-status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: var(--primary);
    font-weight: 600;
  }
  .status-dot {
    width: 6px;
    height: 6px;
    background: var(--primary);
    border-radius: 50%;
    display: block;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.4;
      transform: scale(1.5);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  .listing-preview-card {
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--white);
  }
  .preview-img-placeholder {
    height: 180px;
    background: var(--gray-50);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-300);
  }
  .placeholder-content {
    text-align: center;
  }
  .placeholder-content p {
    font-size: 0.8rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }

  .preview-content {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .preview-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .preview-cat-tag {
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--gray-500);
    text-transform: uppercase;
  }
  .preview-price-tag {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--primary);
  }
  .preview-item-title {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--gray-900);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .preview-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .preview-condition-wrap {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray-500);
  }
  .condition-dot {
    width: 8px;
    height: 8px;
    background: var(--primary-soft);
    border-radius: 50%;
  }
  .preview-location {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray-400);
  }

  /* Tips Card */
  .tips-card {
    background: #fffbeb;
    border: 1px solid #fef3c7;
    border-radius: var(--radius-lg);
    padding: 1.5rem;
  }
  .tips-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
  }
  .tips-icon {
    width: 32px;
    height: 32px;
    background: #fef3c7;
    color: #d97706;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .tips-title {
    font-size: 0.95rem;
    font-weight: 800;
    color: #92400e;
  }

  .tips-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    list-style: none;
  }
  .tips-list li {
    display: flex;
    gap: 1rem;
  }
  .tip-num {
    width: 20px;
    height: 20px;
    background: var(--white);
    border: 1px solid #d97706;
    color: #d97706;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 800;
    flex-shrink: 0;
  }
  .tips-list p {
    font-size: 0.85rem;
    color: #92400e;
    line-height: 1.5;
  }
  .tips-list p strong {
    color: #78350f;
    font-weight: 800;
  }
</style>

<script>
  const uploadZone = document.getElementById("uploadZone");
  const fileInput = document.getElementById("fileInput") as HTMLInputElement;
  const titleInput = document.getElementById("title") as HTMLInputElement;
  const categoryInput = document.getElementById(
    "category",
  ) as HTMLSelectElement;
  const conditionInput = document.getElementById(
    "condition",
  ) as HTMLSelectElement;
  const priceInput = document.getElementById("price") as HTMLInputElement;
  const descriptionInput = document.getElementById(
    "description",
  ) as HTMLTextAreaElement;

  const previewTitle = document.getElementById("previewTitle");
  const previewPrice = document.getElementById("previewPrice");
  const previewCat = document.getElementById("previewCat");
  const previewCondition = document.getElementById("previewCondition");

  const titleCount = document.getElementById("titleCount");
  const descCount = document.getElementById("descCount");

  // Interactive Upload
  uploadZone?.addEventListener("click", () => fileInput?.click());

  uploadZone?.addEventListener("dragover", (e) => {
    e.preventDefault();
    uploadZone.classList.add("dragover");
  });

  uploadZone?.addEventListener("dragleave", () => {
    uploadZone.classList.remove("dragover");
  });

  uploadZone?.addEventListener("drop", (e) => {
    e.preventDefault();
    uploadZone.classList.remove("dragover");
    if (e.dataTransfer && e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files;
      handleFileSelect();
    }
  });

  fileInput?.addEventListener("change", handleFileSelect);

  function handleFileSelect() {
    // Basic logic for previews could go here
    console.log("Files selected:", fileInput.files);
  }

  // Live Preview Updates
  titleInput?.addEventListener("input", () => {
    if (previewTitle)
      previewTitle.textContent = titleInput.value || "Your listing title here";
    if (titleCount) titleCount.textContent = `${titleInput.value.length}/80`;
  });

  categoryInput?.addEventListener("change", () => {
    if (previewCat) previewCat.textContent = categoryInput.value || "Category";
  });

  conditionInput?.addEventListener("change", () => {
    if (previewCondition)
      previewCondition.textContent = conditionInput.value || "Condition";
  });

  priceInput?.addEventListener("input", () => {
    const val = parseFloat(priceInput.value);
    if (previewPrice)
      previewPrice.textContent = isNaN(val) ? "$0" : `$${val.toLocaleString()}`;
  });

  descriptionInput?.addEventListener("input", () => {
    if (descCount)
      descCount.textContent = `${descriptionInput.value.length}/1000`;
  });
</script>
