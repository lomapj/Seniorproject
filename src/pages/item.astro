---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Item Detail">
  <div class="container item-page">

    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/marketplace">Marketplace</a>
      <span class="bc-sep">â€º</span>
      <a href="/marketplace">Books</a>
      <span class="bc-sep">â€º</span>
      <span>Biology Textbook</span>
    </nav>

    <div class="item-layout">

      <!-- Left: Images -->
      <div class="item-gallery">
        <div class="img-main" style="background: linear-gradient(135deg,#2d6a4f,#52b788)">
          <span class="img-emoji">ðŸ“—</span>
        </div>
        <div class="img-thumbs">
          {[1,2,3,4].map(i => (
            <button type="button" class={`img-thumb${i === 1 ? ' active' : ''}`} aria-label={`View image ${i}`}
              style={`background: linear-gradient(135deg,#2d6a4f,#52b788); opacity:${i === 1 ? 1 : 0.55}`}>
              <span style="font-size:1.2rem">ðŸ“—</span>
            </button>
          ))}
        </div>
      </div>

      <!-- Right: Details -->
      <div class="item-details">
        <div class="item-header">
          <div>
            <span class="tag">Books</span>
            <span class="condition-badge">Like New</span>
          </div>
          <button type="button" class="fav-btn" id="favBtn" aria-label="Save listing">
            <svg id="heartIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </button>
        </div>

        <h1 class="item-title">Biology Textbook</h1>
        <p class="item-price">$45</p>

        <div class="item-meta">
          <div class="meta-row">
            <span class="meta-label">Category</span>
            <span class="meta-val">Books</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Condition</span>
            <span class="meta-val">Like New</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Posted</span>
            <span class="meta-val">January 15, 2025</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Status</span>
            <span class="status-chip available">Available</span>
          </div>
        </div>

        <div class="item-section">
          <h2 class="section-heading">Description</h2>
          <p class="item-desc">
            Gently used Florida Biology textbook in excellent condition. This comprehensive biology textbook covers all major topics including cell biology, genetics, evolution, and ecology. Perfect for BIO 101 or general biology courses. No highlighting or writing inside. All pages intact. Smoke-free home.
          </p>
        </div>

        <div class="seller-card">
          <div class="seller-info">
            <div class="seller-avatar">SJ</div>
            <div>
              <p class="seller-name">Sarah J.</p>
              <div class="seller-rating">
                <span class="stars" style="font-size:0.85rem">â˜…â˜…â˜…â˜…Â½</span>
                <span class="stars-text">4.5 out of 5 stars</span>
              </div>
            </div>
          </div>
          <a href="/profile" class="view-profile-link">View Profile â†’</a>
        </div>

        <div class="item-actions">
          <a href="/messages" class="btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            Message Seller
          </a>
          <button type="button" class="btn-report" id="reportBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/>
            </svg>
            Report Listing
          </button>
        </div>
      </div>
    </div>

    <!-- Report Modal (hidden by default) -->
    <div class="modal-overlay" id="reportModal" style="display:none" aria-modal="true" role="dialog">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Report Listing</h3>
          <button type="button" class="modal-close" id="modalClose" aria-label="Close">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Reason</label>
            <select class="form-select">
              <option value="">Select a reason</option>
              <option>Misleading listing</option>
              <option>Inappropriate content</option>
              <option>Suspected scam</option>
              <option>Wrong category</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Description (optional)</label>
            <textarea class="form-input" rows="4" placeholder="Describe the issue..." style="resize:vertical"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="cancelReport">Cancel</button>
          <button type="submit" class="btn-danger-solid">Submit Report</button>
        </div>
      </div>
    </div>

  </div>
</Layout>

<style>
  .item-page { padding-top: 1.5rem; padding-bottom: 3rem; }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.8rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .breadcrumb a { color: var(--green); text-decoration: none; font-weight: 500; }
  .breadcrumb a:hover { text-decoration: underline; }
  .breadcrumb span:last-child { color: var(--gray-500); }
  .bc-sep { color: var(--gray-300); }

  .item-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
  }

  @media (max-width: 768px) { .item-layout { grid-template-columns: 1fr; gap: 1.5rem; } }

  /* Gallery */
  .item-gallery { display: flex; flex-direction: column; gap: 0.75rem; }

  .img-main {
    border-radius: var(--radius-lg);
    height: 360px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .img-emoji { font-size: 7rem; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.18)); user-select: none; }

  .img-thumbs { display: flex; gap: 0.6rem; }

  .img-thumb {
    flex: 1;
    height: 70px;
    border-radius: var(--radius-sm);
    border: 2.5px solid transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.15s, opacity 0.15s;
    overflow: hidden;
  }

  .img-thumb.active { border-color: var(--green); opacity: 1 !important; }
  .img-thumb:hover  { opacity: 0.85 !important; }

  /* Details */
  .item-details { display: flex; flex-direction: column; gap: 1.25rem; }

  .item-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .item-header > div { display: flex; align-items: center; gap: 0.5rem; }

  .condition-badge {
    background: var(--green-light);
    color: var(--green-dark);
    font-size: 0.72rem;
    font-weight: 600;
    padding: 0.22rem 0.6rem;
    border-radius: 20px;
    border: 1px solid rgba(0,97,83,0.2);
  }

  .fav-btn {
    background: none;
    border: 1.5px solid var(--gray-200);
    border-radius: 50%;
    width: 38px;
    height: 38px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-400);
    transition: color 0.15s, border-color 0.15s;
    flex-shrink: 0;
  }

  .fav-btn:hover, .fav-btn.saved { color: #e11d48; border-color: #e11d48; }
  .fav-btn.saved svg { fill: #e11d48; stroke: #e11d48; }

  .item-title { font-size: 1.6rem; font-weight: 800; line-height: 1.2; color: var(--gray-800); }
  .item-price { font-size: 1.8rem; font-weight: 800; color: var(--green); }

  .item-meta {
    background: var(--gray-50);
    border-radius: var(--radius-md);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.55rem;
    border: 1px solid var(--gray-200);
  }

  .meta-row { display: flex; align-items: center; justify-content: space-between; }
  .meta-label { font-size: 0.8rem; font-weight: 600; color: var(--gray-500); }
  .meta-val   { font-size: 0.85rem; font-weight: 600; color: var(--gray-700); }

  .status-chip {
    font-size: 0.72rem;
    font-weight: 700;
    padding: 0.22rem 0.6rem;
    border-radius: 20px;
    text-transform: capitalize;
  }

  .status-chip.available { background: #dcfce7; color: #15803d; }
  .status-chip.pending   { background: var(--gold-light); color: #92400e; }
  .status-chip.sold      { background: var(--red-light); color: var(--red); }

  .item-section { display: flex; flex-direction: column; gap: 0.5rem; }

  .section-heading {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--gray-700);
    padding-bottom: 0.4rem;
    border-bottom: 1px solid var(--gray-200);
  }

  .item-desc { font-size: 0.88rem; color: var(--gray-600); line-height: 1.65; }

  /* Seller card */
  .seller-card {
    background: white;
    border: 1.5px solid var(--gray-200);
    border-radius: var(--radius-md);
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
  }

  .seller-info { display: flex; align-items: center; gap: 0.75rem; }

  .seller-avatar {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: var(--green);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
    flex-shrink: 0;
  }

  .seller-name { font-size: 0.9rem; font-weight: 700; color: var(--gray-800); }

  .seller-rating { display: flex; align-items: center; gap: 0.25rem; margin-top: 0.1rem; }

  .view-profile-link {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--green);
    text-decoration: none;
    white-space: nowrap;
    transition: opacity 0.15s;
  }

  .view-profile-link:hover { opacity: 0.7; }

  /* Actions */
  .item-actions { display: flex; flex-direction: column; gap: 0.6rem; }

  .btn-report {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    background: transparent;
    color: var(--gray-500);
    font-weight: 600;
    font-size: 0.82rem;
    padding: 0.6rem 1.25rem;
    border-radius: var(--radius-sm);
    border: 1.5px solid var(--gray-200);
    cursor: pointer;
    font-family: var(--font);
    transition: color 0.15s, border-color 0.15s;
    width: 100%;
  }

  .btn-report:hover { color: var(--red); border-color: var(--red); }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
  }

  .modal {
    background: white;
    border-radius: var(--radius-lg);
    width: 100%;
    max-width: 460px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--gray-200);
  }

  .modal-title { font-size: 1rem; font-weight: 700; }

  .modal-close {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--gray-400);
    display: flex;
    align-items: center;
    transition: color 0.15s;
  }

  .modal-close:hover { color: var(--gray-700); }

  .modal-body {
    padding: 1.25rem 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--gray-200);
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
  }

  .modal-footer .btn-secondary { width: auto; }

  .btn-danger-solid {
    background: var(--red);
    color: white;
    border: none;
    padding: 0.6rem 1.25rem;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 700;
    font-family: var(--font);
    cursor: pointer;
    transition: background 0.15s;
  }

  .btn-danger-solid:hover { background: #b91c1c; }
</style>

<script>
  const favBtn   = document.getElementById('favBtn');
  const reportBtn  = document.getElementById('reportBtn');
  const reportModal = document.getElementById('reportModal');
  const modalClose  = document.getElementById('modalClose');
  const cancelReport = document.getElementById('cancelReport');
  const thumbs = document.querySelectorAll<HTMLButtonElement>('.img-thumb');

  favBtn?.addEventListener('click', () => favBtn.classList.toggle('saved'));

  reportBtn?.addEventListener('click', () => {
    if (reportModal) reportModal.style.display = 'flex';
  });

  function closeModal() {
    if (reportModal) reportModal.style.display = 'none';
  }

  modalClose?.addEventListener('click',  closeModal);
  cancelReport?.addEventListener('click', closeModal);

  reportModal?.addEventListener('click', (e) => {
    if (e.target === reportModal) closeModal();
  });

  thumbs.forEach(thumb => {
    thumb.addEventListener('click', () => {
      thumbs.forEach(t => {
        t.classList.remove('active');
        t.style.opacity = '0.55';
      });
      thumb.classList.add('active');
      thumb.style.opacity = '1';
    });
  });
</script>
